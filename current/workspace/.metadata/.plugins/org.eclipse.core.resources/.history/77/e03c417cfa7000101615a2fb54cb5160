package edu.mit.virtualnodecloud;

import android.app.Activity;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.net.wifi.WifiManager;
import android.util.Log;

public class VirtualNodeCloud extends Activity {
	final static String TAG = "VirtualNodeCloud";
	
	private WifiManager wifiManager;
	private boolean shouldDisableWifi;
	
	// Deal with received intents
	private BroadcastReceiver scanReceiver = new BroadcastReceiver() {
        @Override
        public void onReceive(Context context, Intent intent) {
            if (WifiManager.SCAN_RESULTS_AVAILABLE_ACTION.equals(intent.getAction())) {
                if (shouldDisableWifi) {
                    wifiManager.setWifiEnabled(false);
                } // else stop disabling it
                shouldDisableWifi = false;
            }
        }
    };
	
	
    @Override
    public void onCreate() {
		super.onCreate();
		Log.d(TAG, "onCreate");
		
		registerReceiver(scanReceiver, new IntentFilter(WifiManager.SCAN_RESULTS_AVAILABLE_ACTION));
        wifiManager = (WifiManager) getSystemService(Context.WIFI_SERVICE);
        if (!wifiManager.isWifiEnabled()) {
            wifiManager.setWifiEnabled(true);
            shouldDisableWifi = true;
        }
        wifiManager.startScan();
    }
	
    @Override
    public void onTerminate() {
        /*if (service != null) {
            Log.e(TAG, "The app is terminated while the service is running!");
            service.stopRequest();
        }*/
        // clean up after yourself
        if (shouldDisableWifi) {
            wifiManager.setWifiEnabled(false);
        }
        try {
            unregisterReceiver(scanReceiver);
        } catch (Exception e) {
            // ignore IntentReceiverLeaked
        }
        super.onTerminate();
    }
}